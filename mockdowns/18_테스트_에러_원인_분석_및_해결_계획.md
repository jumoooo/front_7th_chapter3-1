# 🔍 테스트 에러 원인 분석 및 해결 계획

> 📅 **작성 일자**: 2025년  
> 🎯 **목적**: 테스트 코드 수정 없이 테스트 에러 해결

---

## 🔴 문제 상황

### 에러 메시지
```
Unable to find an accessible element with the role "button" and name "사용자"
Unable to find role="button" and name "게시글"
```

### 테스트 코드 요구사항
- `getByRole('button', { name: '사용자' })`로 찾으려고 함
- `getByRole('button', { name: '게시글' })`로 찾으려고 함

---

## 📊 원인 분석

### Before 패키지 (정상 작동)
```tsx
<button onClick={() => setEntityType('post')}>
  게시글
</button>
```
- `role` 속성이 없음
- 기본적으로 `role="button"`으로 인식됨
- 테스트에서 `getByRole('button', ...)`로 찾을 수 있음

### After 패키지 (에러 발생)
```tsx
<Button
  role="tab"
  aria-selected={...}
  aria-controls="entity-content"
>
  게시글
</Button>
```
- `role="tab"`이 명시적으로 설정됨
- Testing Library는 명시적으로 설정된 role만 인식함
- `getByRole('button', ...)`로 찾을 수 없음
- `getByRole('tab', ...)`로만 찾을 수 있음

---

## 🎯 해결 방안

### 옵션 1: role="tab" 제거 (권장) ✅

**장점:**
- 테스트 코드 수정 불필요
- Before 패키지와 동일한 동작
- 접근성은 `aria-selected`, `aria-controls` 등으로 유지 가능

**단점:**
- 탭 패턴의 접근성 표준에서 약간 벗어남 (하지만 `aria-selected` 등으로 보완 가능)

**구현:**
- `EntityTypeTabs.tsx`에서 `role="tab"` 제거
- `role="tablist"`는 유지 (컨테이너 역할)
- `aria-selected`, `aria-controls`, `tabIndex` 등은 유지

### 옵션 2: role="button" 추가 (비권장) ❌

**문제점:**
- HTML 표준에서 하나의 요소에 여러 role을 가질 수 없음
- 접근성 도구에서 혼란을 줄 수 있음

---

## ✅ 선택한 해결 방법

**옵션 1: role="tab" 제거**

### 이유
1. Before 패키지와 동일한 동작 유지
2. 테스트 코드 수정 불필요
3. 접근성은 `aria-selected`, `aria-controls`, `tabIndex` 등으로 충분히 보완 가능
4. `role="tablist"`는 유지하여 컨테이너의 의미는 유지

---

## 📝 수정 계획

### 1단계: EntityTypeTabs.tsx 수정
- `role="tab"` 제거
- `aria-selected`, `aria-controls`, `tabIndex`는 유지
- `role="tablist"`는 유지 (컨테이너)

### 2단계: 테스트 실행 및 확인
- 테스트가 통과하는지 확인
- 기능이 정상 작동하는지 확인

---

## 🔍 접근성 고려사항

### 유지되는 접근성 기능
- ✅ `role="tablist"` (컨테이너)
- ✅ `aria-selected` (선택 상태)
- ✅ `aria-controls` (연결된 패널)
- ✅ `tabIndex` (키보드 네비게이션)
- ✅ 키보드 이벤트 핸들러 (`onKeyDown`)

### 제거되는 것
- ❌ `role="tab"` (명시적 role)

### 결론
`role="tab"`을 제거해도 `aria-selected`, `aria-controls` 등으로 충분한 접근성을 제공할 수 있습니다.

---

## 📋 체크리스트

- [ ] `EntityTypeTabs.tsx`에서 `role="tab"` 제거
- [ ] `aria-selected`, `aria-controls`, `tabIndex` 유지 확인
- [ ] 테스트 실행 및 통과 확인
- [ ] 기능 동작 확인 (탭 전환, 키보드 네비게이션 등)

---

> ✅ **다음 액션**: `EntityTypeTabs.tsx`에서 `role="tab"` 제거

